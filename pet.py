import os
import time
import sys
from typing import List
import select
import termios
"""

Credit for computer animation:https://www.asciiart.eu/computers/computers

Credit for numbers: https://patorjk.com/software/taag/



"""
# Increased width of ASCII numbers for better proportions
asciiNumbers = {
    '0': [
        "   ____    ",
        "  / __ \\   ",
        " / / / /   ",
        "/ /_/ /    ",
        "\\____/     "
    ],
    '1': [
        "   ___     ",
        "  <  /     ",
        "  / /      ",
        " / /       ",
        "/_/        "
    ],
    '2': [
        " ___       ",
        "|__ \\      ",
        "__/ /      ",
        "/ __/      ",
        "/____/     "
    ],
    '3': [
        " _____     ",
        "|__  /     ",
        "  /_ <     ",
        "___/ /     ",
        "/____/     "
    ],
    '4': [
        "__ __      ",
        "/ // /     ",
        "/ // /_    ",
        "/__  __/   ",
        "  /_/      "
    ],
    '5': [
        " ______    ",
        "/ ____/    ",
        "/___ \\     ",
        "____/ /    ",
        "/_____/    "
    ],
    '6': [
        " _____     ",
        "/ ___/     ",
        "/ __ \\     ",
        "/ /_/ /    ",
        "\\____/     "
    ],
    '7': [
        " _____     ",
        "/__  /     ",
        "  / /      ",
        " / /       ",
        "/_/        "
    ],
    '8': [
        " ____      ",
        "( __ )     ",
        "/ __  |    ",
        "/ /_/ /    ",
        "\\____/     "
    ],
    '9': [
        " ____      ",
        "/ __ \\     ",
        "/ /_/ /    ",
        "\\__, /     ",
        "/____/     "
    ],
    ':': [
        "   _       ",
        "  (_)      ",
        "   _       ",
        "  (_)      ",
        "           "
    ]
}
framesActive = [
        ["   _______________                        |*\_/*|________",
        "  |  ___________  |     .-.     .-.      ||_/-\_|______  |",
        "  | |           | |    .****. .****.     | |           | |",
        "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
        "  | |     -     | |     .*********.      | |     -     | |",
        "  | |   \___/   | |      .*******.       | |   \___/   | |",
        "  | |___     ___| |       .*****.        | |___________| |",
        "  |_____|\_/|_____|        .***.         |_______________|",
        "    _|__|/ \|_|_.............*.............._|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
        ["   _______________                        |*\_/*|________",
        "  |  ___________  |     .-.     .-.      ||_/-\_|______  |",
        "  | |           | |    .****. .****.     | |           | |",
        "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
        "  | |     -     | |     .*********.      | |     -     | |",
        "  | |   \___/   | |      .*******.       | |   \___/   | |",
        "  | |___     ___| |       .*****.        | |___________| |",
        "  |_____|\_/|_____|        .***.         |_______________|",
        "    _|__|/ \|_|_^............*.............^_|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
        ["   _______________                        |*\_/*|________",
        "  |  ___________  |     .-.     .-.      ||_/-\_|______  |",
        "  | |           | |    .****. .****.     | |           | |",
        "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
        "  | |     -     | |     .*********.      | |     -     | |",
        "  | |   \___/   | |      .*******.       | |   \___/   | |",
        "  | |___     ___| |       .*****.        | |___________| |",
        "  |_____|\_/|_____|        .***.         |_______________|",
        "    _|__|/ \|_|_.^...........*............^._|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
        ["   _______________                        |*\_/*|________",
        "  |  ___________  |     .-.     .-.      ||_/-\_|______  |",
        "  | |           | |    .****. .****.     | |           | |",
        "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
        "  | |     -     | |     .*********.      | |     -     | |",
        "  | |   \___/   | |      .*******.       | |   \___/   | |",
        "  | |___     ___| |       .*****.        | |___________| |",
        "  |_____|\_/|_____|        .***.         |_______________|",
        "    _|__|/ \|_|_..^..........*...........^.._|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
        ["   _______________                        |*\_/*|________",
        "  |  ___________  |     .-.     .-.      ||_/-\_|______  |",
        "  | |           | |    .****. .****.     | |           | |",
        "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
        "  | |     -     | |     .*********.      | |     -     | |",
        "  | |   \___/   | |      .*******.       | |   \___/   | |",
        "  | |___     ___| |       .*****.        | |___________| |",
        "  |_____|\_/|_____|        .***.         |_______________|",
        "    _|__|/ \|_|_...^.........*..........^..._|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
        ["   _______________                        |*\_/*|________",
        "  |  ___________  |     .-.     .-.      ||_/-\_|______  |",
        "  | |           | |    .****. .****.     | |           | |",
        "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
        "  | |     -     | |     .*********.      | |     -     | |",
        "  | |   \___/   | |      .*******.       | |   \___/   | |",
        "  | |___     ___| |       .*****.        | |___________| |",
        "  |_____|\_/|_____|        .***.         |_______________|",
        "    _|__|/ \|_|_....^........*.........^...._|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
        ["   _______________                        |*\_/*|________",
        "  |  ___________  |     .-.     .-.      ||_/-\_|______  |",
        "  | |           | |    .****. .****.     | |           | |",
        "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
        "  | |     -     | |     .*********.      | |     -     | |",
        "  | |   \___/   | |      .*******.       | |   \___/   | |",
        "  | |___     ___| |       .*****.        | |___________| |",
        "  |_____|\_/|_____|        .***.         |_______________|",
        "    _|__|/ \|_|_.....^.......*........^....._|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
        ["   _______________                        |*\_/*|________",
        "  |  ___________  |     .-.     .-.      ||_/-\_|______  |",
        "  | |           | |    .****. .****.     | |           | |",
        "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
        "  | |     -     | |     .*********.      | |     -     | |",
        "  | |   \___/   | |      .*******.       | |   \___/   | |",
        "  | |___     ___| |       .*****.        | |___________| |",
        "  |_____|\_/|_____|        .***.         |_______________|",
        "    _|__|/ \|_|_......^......*.......^......_|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
        ["   _______________                        |*\_/*|________",
        "  |  ___________  |     .-.     .-.      ||_/-\_|______  |",
        "  | |           | |    .****. .****.     | |           | |",
        "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
        "  | |     -     | |     .*********.      | |     -     | |",
        "  | |   \___/   | |      .*******.       | |   \___/   | |",
        "  | |___     ___| |       .*****.        | |___________| |",
        "  |_____|\_/|_____|        .***.         |_______________|",
        "    _|__|/ \|_|_.......^.....*......^......._|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
        ["   _______________                        |*\_/*|________",
        "  |  ___________  |     .-.     .-.      ||_/-\_|______  |",
        "  | |           | |    .****. .****.     | |           | |",
        "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
        "  | |     -     | |     .*********.      | |     -     | |",
        "  | |   \___/   | |      .*******.       | |   \___/   | |",
        "  | |___     ___| |       .*****.        | |___________| |",
        "  |_____|\_/|_____|        .***.         |_______________|",
        "    _|__|/ \|_|_........^....*.....^........_|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
        ["   _______________                        |*\_/*|________",
        "  |  ___________  |     .-.     .-.      ||_/-\_|______  |",
        "  | |           | |    .****. .****.     | |           | |",
        "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
        "  | |     -     | |     .*********.      | |     -     | |",
        "  | |   \___/   | |      .*******.       | |   \___/   | |",
        "  | |___     ___| |       .*****.        | |___________| |",
        "  |_____|\_/|_____|        .***.         |_______________|",
        "    _|__|/ \|_|_.........^...*....^........._|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
        ["   _______________                        |*\_/*|________",
        "  |  ___________  |     .-.     .-.      ||_/-\_|______  |",
        "  | |           | |    .****. .****.     | |           | |",
        "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
        "  | |     -     | |     .*********.      | |     -     | |",
        "  | |   \___/   | |      .*******.       | |   \___/   | |",
        "  | |___     ___| |       .*****.        | |___________| |",
        "  |_____|\_/|_____|        .***.         |_______________|",
        "    _|__|/ \|_|_..........^..*...^.........._|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
        ["   _______________                        |*\_/*|________",
        "  |  ___________  |     .-.     .-.      ||_/-\_|______  |",
        "  | |           | |    .****. .****.     | |           | |",
        "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
        "  | |     -     | |     .*********.      | |     -     | |",
        "  | |   \___/   | |      .*******.       | |   \___/   | |",
        "  | |___     ___| |       .*****.        | |___________| |",
        "  |_____|\_/|_____|        .***.         |_______________|",
        "    _|__|/ \|_|_...........^.*.^............_|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
        ["   _______________                        |*\_/*|________",
        "  |  ___________  |     .-.     .-.      ||_/-\_|______  |",
        "  | |           | |    .****. .****.     | |           | |",
        "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
        "  | |     -     | |     .*********.      | |     -     | |",
        "  | |   \___/   | |      .*******.       | |   \___/   | |",
        "  | |___     ___| |       .*****.        | |___________| |",
        "  |_____|\_/|_____|        .***.         |_______________|",
        "    _|__|/ \|_|_............^*^ ............_|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
        ["   _______________     ***     ***        |*\_/*|________",
        "  |  ___________  |    *^^^** **^^^*     ||_/-\_|______  |",
        "  | |           | |   *^****^*^****^*    | |           | |",
        "  | | ' @   @   | |   *^*****^*****^*    | |   *   * ' | |",
        "  | |     -     | |    *^*********^*     | |     -     | |",
        "  | |   \___/   | |     *^*******^*      | |   \___/   | |",
        "  | |___     ___| |      *^*****^*       | |___________| |",
        "  |_____|\_/|_____|       *^***^*        |_______________|",
        "    _|__|/ \|_|_...........*^*^*............_|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
        ["   _______________     ***     ***        |*\_/*|________",
        "  |  ___________  |    *^^^** **^^^*     ||_/-\_|______  |",
        "  | |           | |   *^****^*^****^*    | |           | |",
        "  | | ' @   @   | |   *^*****^*****^*    | |   *   * ' | |",
        "  | |     -     | |    *^*********^*     | |     -     | |",
        "  | |   \___/   | |     *^*******^*      | |   \___/   | |",
        "  | |___     ___| |      *^*****^*       | |___________| |",
        "  |_____|\_/|_____|       *^***^*        |_______________|",
        "    _|__|/ \|_|_...........*^*^*............_|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
        ["   _______________                        |*\_/*|________",
        "  |  ___________  |     .-.     .-.      ||_/-\_|______  |",
        "  | |           | |    .****. .****.     | |           | |",
        "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
        "  | |     -     | |     .*********.      | |     -     | |",
        "  | |   \___/   | |      .*******.       | |   \___/   | |",
        "  | |___     ___| |       .*****.        | |___________| |",
        "  |_____|\_/|_____|        .***.         |_______________|",
        "    _|__|/ \|_|_.............*.............._|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
         ["   _______________     ***     ***        |*\_/*|________",
        "  |  ___________  |    *^^^** **^^^*     ||_/-\_|______  |",
        "  | |           | |   *^****^*^****^*    | |           | |",
        "  | | ' @   @   | |   *^*****^*****^*    | |   *   * ' | |",
        "  | |     -     | |    *^*********^*     | |     -     | |",
        "  | |   \___/   | |     *^*******^*      | |   \___/   | |",
        "  | |___     ___| |      *^*****^*       | |___________| |",
        "  |_____|\_/|_____|       *^***^*        |_______________|",
        "    _|__|/ \|_|_...........*^*^*............_|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
          ["   _______________     ***     ***        |*\_/*|________",
        "  |  ___________  |    *^^^** **^^^*     ||_/-\_|______  |",
        "  | |           | |   *^****^*^****^*    | |           | |",
        "  | | ' @   @   | |   *^*****^*****^*    | |   *   * ' | |",
        "  | |     -     | |    *^*********^*     | |     -     | |",
        "  | |   \___/   | |     *^*******^*      | |   \___/   | |",
        "  | |___     ___| |      *^*****^*       | |___________| |",
        "  |_____|\_/|_____|       *^***^*        |_______________|",
        "    _|__|/ \|_|_...........*^*^*............_|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"],
        
        
              ]
framesDead = [
    ["   _______________                        |*\_/*|________",
        "  |  ___________  |     .-.     .-.      ||_/-\_|______  |",
        "  | |           | |    .****. .****.     | |           | |",
        "  | |   0   0   | |    .*****.*****.     | |   0   0   | |",
        "  | |     -     | |     .*********.      | |     -     | |",
        "  | |   _____   | |      .*******.       | |   _____   | |",
        "  | |___     ___| |       .*****.        | |___________| |",
        "  |_____|\_/|_____|        .***.         |_______________|",
        "    _|__|/ \|_|_.............*.............._|________|_", 
        "   / ********** \                          / ********** \\",
        " /  ************  \                      /  ************  \\",
        "--------------------                    --------------------"] 
    
]

class StopWatch:
    def __init__(self):
        self.activeTime = 0
        self.deadTime = 0
        self.lastToggle = time.time()
        self.isActive = True
        self.isRunning = True

    def toggleState(self):
        """Toggle between active and inactive states."""
        current = time.time()
        elapsed = current - self.lastToggle
        
        if self.isActive:
            self.activeTime += elapsed
        else:
            self.deadTime += elapsed
            
        self.lastToggle = current
        self.isActive = not self.isActive

    def getTimes(self) -> tuple:
        """Get current active and dead times."""
        current = time.time()
        elapsed = current - self.lastToggle
        
        currentActive = self.activeTime
        currentDead = self.deadTime
        
        if self.isActive:
            currentActive += elapsed
        else:
            currentDead += elapsed
        
        return (
            time.strftime("%H:%M:%S", time.gmtime(currentActive)),
            time.strftime("%H:%M:%S", time.gmtime(currentDead))
        )
        
def getFrame(frameNum: int, active: bool) -> List[str]:
    """Get the appropriate frame based on state."""
    if active:
        return framesActive[frameNum]
    else:
        return framesDead[0]
    
def formatStatus(active: bool) -> str:
    """Format the status text."""
    state = "WORKING" if active else "NOT WORKING"
    return f"State: {state} | Press SPACE to toggle state, 'q' to quit"

def convertToAsciiArt(timeStr: str) -> List[str]:
    """Convert time string to ASCII art with proper spacing."""
    result = [''] * 5
    
    for char in timeStr:
        if char in asciiNumbers:
            # Add each line of the current number to the result
            for i in range(5):
                result[i] += asciiNumbers[char][i] + " "  # Add space after each number
    
    return result

def clearScreen():
    """Clear the terminal screen."""
    print('\033[2J\033[H', end='')  # ANSI escape sequence to clear screen and move cursor to home

def drawFrame(frame: List[str], times: tuple, status: str):
    """Draw a single frame with times and status."""
    terminalWidth = os.get_terminal_size().columns
    
    sys.stdout.write("Work Time:".center(terminalWidth) + "\n")
    activeTimeArt = convertToAsciiArt(times[0])
    for line in activeTimeArt:
        sys.stdout.write(line.center(terminalWidth) + "\n")
    
    sys.stdout.write("Break Time:".center(terminalWidth) + "\n")
    deadTimeArt = convertToAsciiArt(times[1])
    for line in deadTimeArt:
        sys.stdout.write(line.center(terminalWidth) + "\n")
    
    for line in frame:
        sys.stdout.write(line.center(terminalWidth) + "\n")
    
    sys.stdout.write(status.center(terminalWidth))
    sys.stdout.flush()
    
def animateComputers():
    """Run the main animation loop with stopwatch."""
    frameNum = 0
    stopwatch = StopWatch()
    
    # Set up non-blocking input
    old_settings = termios.tcgetattr(sys.stdin)
    new_settings = termios.tcgetattr(sys.stdin)
    new_settings[3] = new_settings[3] & ~(termios.ECHO | termios.ICANON) # turn off echo and canonical mode.
    termios.tcsetattr(sys.stdin, termios.TCSAFLUSH, new_settings) #tcsa flush allows output queue to be read, and also flush anything that is stuck in input queue
    
    try:
        while True:
            clearScreen()
            
            frame = getFrame(frameNum=frameNum, active=stopwatch.isActive)
            times = stopwatch.getTimes()
            status = formatStatus(stopwatch.isActive)
            
            # Draw everything with minimal spacing
            print("\033[H", end='')  # Move cursor to home position
            drawFrame(frame, times, status)
            
            if sys.stdin in select.select([sys.stdin], [], [], 0)[0]:
                key = sys.stdin.read(1)
                if key == ' ':
                    stopwatch.toggleState()
                elif key.lower() == 'q':
                    break
            
            time.sleep(0.2)
            frameNum = (frameNum + 1) % len(framesActive)

    except KeyboardInterrupt:
        print("Animation stopped.")
        clearScreen()
    finally:
        termios.tcsetattr(sys.stdin, termios.TCSAFLUSH, old_settings)
        clearScreen()
        times=stopwatch.getTimes()
        print(f'Work Time:{times[0]}')
        print(f'Break Time:{times[1]}')



if __name__ == "__main__":
    try:
        animateComputers()
    except Exception as e:
        print(f"Error: {e}")